<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会員ログインテスト</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #c9302c;
            padding-bottom: 10px;
        }
        h2 {
            color: #c9302c;
            margin-top: 0;
        }
        button {
            background: #c9302c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #a02622;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
    </style>
</head>
<body>
    <h1>🧪 会員システム統合テスト</h1>
    
    <div class="test-section">
        <h2>1. 会員ログインテスト</h2>
        <div class="test-grid">
            <button onclick="testLogin('basic')">ベーシック会員ログイン</button>
            <button onclick="testLogin('standard')">スタンダード会員ログイン</button>
            <button onclick="testLogin('premium')">プレミアム会員ログイン</button>
            <button onclick="testLogin('invalid')">無効な認証情報</button>
        </div>
        <div id="loginResult"></div>
    </div>

    <div class="test-section">
        <h2>2. 会員情報取得テスト</h2>
        <button onclick="getMemberInfo()">現在の会員情報取得</button>
        <button onclick="checkLoginStatus()">ログイン状態確認</button>
        <div id="memberResult"></div>
    </div>

    <div class="test-section">
        <h2>3. アクセス制御テスト</h2>
        <div class="test-grid">
            <button onclick="testAccess('basic')">ベーシックコンテンツ</button>
            <button onclick="testAccess('standard')">スタンダードコンテンツ</button>
            <button onclick="testAccess('premium')">プレミアムコンテンツ</button>
        </div>
        <div id="accessResult"></div>
    </div>

    <div class="test-section">
        <h2>4. API接続テスト</h2>
        <button onclick="testAPIHealth()">ヘルスチェック</button>
        <button onclick="testPublications()">刊行物API</button>
        <button onclick="testSeminars()">セミナーAPI</button>
        <div id="apiResult"></div>
    </div>

    <div class="test-section">
        <h2>5. ページナビゲーションテスト</h2>
        <div class="test-grid">
            <button onclick="navigateTo('/')">ホーム</button>
            <button onclick="navigateTo('/login')">ログイン</button>
            <button onclick="navigateTo('/my-account')">マイアカウント</button>
            <button onclick="navigateTo('/upgrade')">アップグレード</button>
            <button onclick="navigateTo('/publications')">刊行物</button>
            <button onclick="navigateTo('/seminars')">セミナー</button>
            <button onclick="navigateTo('/contact')">お問い合わせ</button>
        </div>
        <div id="navResult"></div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8080';
        
        // ログインテスト
        async function testLogin(type) {
            const credentials = {
                basic: { email: 'member@example.com', password: 'password' },
                standard: { email: 'standard@example.com', password: 'password' },
                premium: { email: 'premium@example.com', password: 'password' },
                invalid: { email: 'wrong@example.com', password: 'wrongpass' }
            };
            
            const resultDiv = document.getElementById('loginResult');
            
            try {
                // mockServerのログイン関数を直接呼び出し
                const mockLogin = async (email, password) => {
                    const validCredentials = [
                        { email: 'member@example.com', password: 'password', type: 'basic' },
                        { email: 'standard@example.com', password: 'password', type: 'standard' },
                        { email: 'premium@example.com', password: 'password', type: 'premium' }
                    ];
                    
                    const user = validCredentials.find(
                        cred => cred.email === email && cred.password === password
                    );
                    
                    if (user) {
                        const token = `member_token_${Date.now()}`;
                        const memberData = {
                            id: Math.random().toString(36).substr(2, 9),
                            name: type === 'basic' ? '山田太郎' : type === 'standard' ? '佐藤花子' : '田中一郎',
                            email: email,
                            company: '株式会社テスト',
                            membershipType: user.type
                        };
                        
                        localStorage.setItem('memberToken', token);
                        localStorage.setItem('memberUser', JSON.stringify(memberData));
                        
                        return { success: true, member: memberData, token };
                    }
                    
                    return { success: false, error: 'メールアドレスまたはパスワードが正しくありません' };
                };
                
                const cred = credentials[type];
                const result = await mockLogin(cred.email, cred.password);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ✅ ログイン成功<br>
                            会員: ${result.member.name}<br>
                            ランク: ${result.member.membershipType}<br>
                            トークン: ${result.token.substring(0, 20)}...
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            ❌ ログイン失敗<br>
                            エラー: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ❌ エラー: ${error.message}
                    </div>
                `;
            }
        }
        
        // 会員情報取得
        function getMemberInfo() {
            const resultDiv = document.getElementById('memberResult');
            const memberData = localStorage.getItem('memberUser');
            const token = localStorage.getItem('memberToken');
            
            if (memberData && token) {
                const member = JSON.parse(memberData);
                resultDiv.innerHTML = `
                    <div class="result success">
                        ✅ 会員情報取得成功<br>
                        名前: ${member.name}<br>
                        メール: ${member.email}<br>
                        会社: ${member.company}<br>
                        ランク: ${member.membershipType}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="result info">
                        ℹ️ ログインしていません
                    </div>
                `;
            }
        }
        
        // ログイン状態確認
        function checkLoginStatus() {
            const resultDiv = document.getElementById('memberResult');
            const isLoggedIn = !!localStorage.getItem('memberToken');
            
            resultDiv.innerHTML = `
                <div class="result ${isLoggedIn ? 'success' : 'info'}">
                    ${isLoggedIn ? '✅ ログイン中' : 'ℹ️ 未ログイン'}
                </div>
            `;
        }
        
        // アクセス制御テスト
        function testAccess(requiredType) {
            const resultDiv = document.getElementById('accessResult');
            const memberData = localStorage.getItem('memberUser');
            
            if (!memberData) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ❌ ログインが必要です
                    </div>
                `;
                return;
            }
            
            const member = JSON.parse(memberData);
            const ranks = { basic: 1, standard: 2, premium: 3 };
            const currentRank = ranks[member.membershipType] || 0;
            const requiredRank = ranks[requiredType] || 0;
            
            if (currentRank >= requiredRank) {
                resultDiv.innerHTML = `
                    <div class="result success">
                        ✅ アクセス許可<br>
                        ${requiredType}コンテンツへのアクセスが可能です
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ❌ アクセス拒否<br>
                        ${requiredType}以上の会員ランクが必要です<br>
                        現在: ${member.membershipType}
                    </div>
                `;
            }
        }
        
        // API接続テスト
        async function testAPIHealth() {
            const resultDiv = document.getElementById('apiResult');
            
            try {
                // まずLaravel APIを試す
                const response = await fetch('https://heroic-celebration-production.up.railway.app/api/health');
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ✅ Laravel API接続成功<br>
                            ステータス: ${data.status}<br>
                            サービス: ${data.service}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result info">
                            ℹ️ Laravel API接続失敗 (${response.status})<br>
                            mockServerにフォールバック中
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result info">
                        ℹ️ API接続エラー<br>
                        mockServerを使用しています
                    </div>
                `;
            }
        }
        
        // 刊行物APIテスト
        async function testPublications() {
            const resultDiv = document.getElementById('apiResult');
            
            // mockServerのデータを使用
            const publications = [
                { id: 1, title: 'ちくぎん地域経済レポート Vol.15', requiredMembershipType: 'basic' },
                { id: 2, title: 'Hot Information 2024年3月号', requiredMembershipType: 'standard' },
                { id: 3, title: '特別調査レポート', requiredMembershipType: 'premium' }
            ];
            
            resultDiv.innerHTML = `
                <div class="result success">
                    ✅ 刊行物データ取得成功<br>
                    件数: ${publications.length}件<br>
                    ${publications.map(p => `・${p.title} (${p.requiredMembershipType})`).join('<br>')}
                </div>
            `;
        }
        
        // セミナーAPIテスト
        async function testSeminars() {
            const resultDiv = document.getElementById('apiResult');
            
            // mockServerのデータを使用
            const seminars = [
                { id: 1, title: '地域経済動向セミナー', date: '2024-04-15' },
                { id: 2, title: 'デジタル化推進セミナー', date: '2024-05-20' }
            ];
            
            resultDiv.innerHTML = `
                <div class="result success">
                    ✅ セミナーデータ取得成功<br>
                    件数: ${seminars.length}件<br>
                    ${seminars.map(s => `・${s.title} (${s.date})`).join('<br>')}
                </div>
            `;
        }
        
        // ページナビゲーション
        function navigateTo(path) {
            const resultDiv = document.getElementById('navResult');
            const fullUrl = `${BASE_URL}/#${path}`;
            
            resultDiv.innerHTML = `
                <div class="result info">
                    📍 ${fullUrl} へ移動中...
                </div>
            `;
            
            window.open(fullUrl, '_blank');
        }
    </script>
</body>
</html>