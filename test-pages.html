<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ページデータテスト</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1A1A1A;
            margin-top: 0;
        }
        button {
            background: #da5761;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #c44853;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .error {
            background: #fee2e2;
            border-color: #fca5a5;
            color: #dc2626;
        }
        .success {
            background: #d1fae5;
            border-color: #6ee7b7;
            color: #065f46;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f9f9f9;
            font-weight: 600;
        }
        .page-key {
            font-family: monospace;
            background: #e5e5e5;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>📄 ページデータテスト</h1>
    
    <div class="section">
        <h2>1. localStorage のデータを確認</h2>
        <button onclick="checkLocalStorage()">localStorage確認</button>
        <button onclick="clearLocalStorage()">localStorage クリア</button>
        <button onclick="resetToDefault()">デフォルトデータにリセット</button>
        <div id="localStorage-result" class="result"></div>
    </div>

    <div class="section">
        <h2>2. MockServer のページデータを確認</h2>
        <button onclick="testGetPages()">getPages() テスト</button>
        <div id="pages-result" class="result"></div>
    </div>

    <div class="section">
        <h2>3. 個別ページの取得テスト</h2>
        <select id="pageKey">
            <option value="about">about</option>
            <option value="services">services</option>
            <option value="seminars">seminars</option>
            <option value="publications">publications</option>
            <option value="news">news</option>
            <option value="contact">contact</option>
            <option value="faq">faq</option>
            <option value="glossary">glossary</option>
            <option value="privacy">privacy</option>
            <option value="terms">terms</option>
        </select>
        <button onclick="testGetPage()">getPage() テスト</button>
        <div id="page-result" class="result"></div>
    </div>

    <script>
        const STORAGE_KEY = 'cms_mock_data';

        function checkLocalStorage() {
            const resultDiv = document.getElementById('localStorage-result');
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    const parsed = JSON.parse(data);
                    let html = '<h3>localStorage データ:</h3>';
                    html += `<p>セミナー数: ${parsed.seminars ? parsed.seminars.length : 0}</p>`;
                    html += `<p>刊行物数: ${parsed.publications ? parsed.publications.length : 0}</p>`;
                    html += `<p>お知らせ数: ${parsed.notices ? parsed.notices.length : 0}</p>`;
                    html += `<p>メディア数: ${parsed.media ? parsed.media.length : 0}</p>`;
                    html += `<p>会員数: ${parsed.members ? parsed.members.length : 0}</p>`;
                    
                    html += '<h4>ページデータ:</h4>';
                    if (parsed.pages) {
                        const pageKeys = Object.keys(parsed.pages);
                        html += `<p>ページ数: ${pageKeys.length}</p>`;
                        html += '<table>';
                        html += '<tr><th>ページキー</th><th>タイトル</th><th>最終更新</th></tr>';
                        pageKeys.forEach(key => {
                            const page = parsed.pages[key];
                            html += `<tr>`;
                            html += `<td><span class="page-key">${key}</span></td>`;
                            html += `<td>${page.title || '(なし)'}</td>`;
                            html += `<td>${page.lastUpdated || '(なし)'}</td>`;
                            html += `</tr>`;
                        });
                        html += '</table>';
                    } else {
                        html += '<p style="color: red;">ページデータがありません！</p>';
                    }
                    
                    resultDiv.innerHTML = html;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = 'localStorage にデータがありません';
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `エラー: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        function clearLocalStorage() {
            const resultDiv = document.getElementById('localStorage-result');
            localStorage.removeItem(STORAGE_KEY);
            resultDiv.innerHTML = 'localStorage をクリアしました。ページをリロードすると新しいデータが作成されます。';
            resultDiv.className = 'result success';
        }

        function resetToDefault() {
            const resultDiv = document.getElementById('localStorage-result');
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }

        async function testGetPages() {
            const resultDiv = document.getElementById('pages-result');
            try {
                // mockServer を動的にインポート
                const module = await import('./src/mockServer.js');
                const mockServer = module.default;
                
                const pages = await mockServer.getPages();
                let html = '<h3>getPages() の結果:</h3>';
                html += `<p>取得したページ数: ${pages.length}</p>`;
                html += '<table>';
                html += '<tr><th>ページキー</th><th>タイトル</th><th>コンテンツ</th><th>最終更新</th></tr>';
                pages.forEach(page => {
                    html += `<tr>`;
                    html += `<td><span class="page-key">${page.pageKey}</span></td>`;
                    html += `<td>${page.title || '(なし)'}</td>`;
                    html += `<td>${page.content ? page.content.substring(0, 30) + '...' : '(なし)'}</td>`;
                    html += `<td>${page.lastUpdated || '(なし)'}</td>`;
                    html += `</tr>`;
                });
                html += '</table>';
                
                resultDiv.innerHTML = html;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = `エラー: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testGetPage() {
            const resultDiv = document.getElementById('page-result');
            const pageKey = document.getElementById('pageKey').value;
            
            try {
                const module = await import('./src/mockServer.js');
                const mockServer = module.default;
                
                const page = await mockServer.getPage(pageKey);
                let html = `<h3>getPage('${pageKey}') の結果:</h3>`;
                html += '<pre>' + JSON.stringify(page, null, 2) + '</pre>';
                
                resultDiv.innerHTML = html;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = `エラー: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // ページ読み込み時に自動チェック
        window.addEventListener('load', () => {
            checkLocalStorage();
        });
    </script>
</body>
</html>