# 会員ランク制限機能 実装計画書

## 📋 概要
会員ランクに応じて刊行物やセミナーへのアクセスを制限し、非ログイン時には高ランクコンテンツをぼかし表示する機能を実装します。

## 🎯 目標
1. **会員ランクによるアクセス制御**
   - ログイン状態と会員ランクに応じたコンテンツ表示
   - 権限のないコンテンツはぼかし表示＋アップグレード誘導

2. **ユーザー体験の向上**
   - 非会員にもコンテンツの存在を示してモチベーション向上
   - スムーズなアップグレード導線

## 👥 会員ランク構造

### 現在の会員タイプ（Laravel側で定義済み）
```php
membership_type: {
  'free'     : '無料会員',      // 基本コンテンツのみ
  'basic'    : 'ベーシック会員',  // 一部の刊行物・セミナー
  'standard' : 'スタンダード会員', // より多くのコンテンツ
  'premium'  : 'プレミアム会員'   // 全てのコンテンツ
}
```

### アクセス権限マトリックス
| コンテンツ | 非ログイン | Free | Basic | Standard | Premium |
|----------|----------|------|-------|----------|---------|
| 無料刊行物 | ⭕ | ⭕ | ⭕ | ⭕ | ⭕ |
| ベーシック刊行物 | 🔍ぼかし | ❌ | ⭕ | ⭕ | ⭕ |
| スタンダード刊行物 | 🔍ぼかし | ❌ | ❌ | ⭕ | ⭕ |
| プレミアム刊行物 | 🔍ぼかし | ❌ | ❌ | ❌ | ⭕ |
| 一般セミナー | ⭕ | ⭕ | ⭕ | ⭕ | ⭕ |
| 会員限定セミナー | 🔍ぼかし | ❌ | ⭕ | ⭕ | ⭕ |
| プレミアムセミナー | 🔍ぼかし | ❌ | ❌ | ❌ | ⭕ |

## 🏗️ 実装アーキテクチャ

### 1. 認証・会員情報管理
```javascript
// stores/auth.js (Vuex Store)
{
  state: {
    isLoggedIn: false,
    member: {
      id: null,
      name: '',
      email: '',
      membershipType: null, // 'free', 'basic', 'standard', 'premium'
      expiryDate: null
    },
    token: null
  },
  getters: {
    canAccess: (state) => (requiredLevel) => {
      // アクセス権限チェックロジック
    }
  }
}
```

### 2. コンテンツ制限コンポーネント

#### ContentRestriction.vue（新規作成）
```vue
<template>
  <div class="content-wrapper">
    <!-- アクセス可能な場合 -->
    <div v-if="hasAccess">
      <slot></slot>
    </div>
    
    <!-- アクセス制限時のぼかし表示 -->
    <div v-else class="restricted-content">
      <div class="blurred-preview">
        <slot name="preview"></slot>
      </div>
      <div class="restriction-overlay">
        <LockIcon />
        <h3>{{ restrictionTitle }}</h3>
        <p>{{ restrictionMessage }}</p>
        <button @click="handleUpgrade">{{ buttonText }}</button>
      </div>
    </div>
  </div>
</template>
```

### 3. 実装が必要なページ・コンポーネント

#### 🔄 修正が必要なコンポーネント

1. **PublicationsMemberPage.vue**
   - 刊行物一覧での制限表示
   - ダウンロードボタンの制御
   - アップグレード誘導

2. **CurrentSeminarsPage.vue**
   - セミナー一覧での制限表示
   - 予約ボタンの制御
   - 会員限定バッジ表示

3. **PublicationDetailPage.vue**
   - 詳細ページでのアクセス制御
   - PDFダウンロード制限

4. **SeminarDetailPage.vue**
   - セミナー詳細のアクセス制御
   - 申込みフォームの制限

#### ✨ 新規作成コンポーネント

1. **ContentRestriction.vue**
   - コンテンツ制限の共通コンポーネント

2. **MembershipBadge.vue**
   - 必要会員ランクを表示するバッジ

3. **UpgradePrompt.vue**
   - アップグレード促進モーダル

4. **LoginPrompt.vue**
   - ログイン促進モーダル

## 📊 データ構造の拡張

### 刊行物（Publications）
```javascript
{
  id: 1,
  title: '経済レポート2025',
  membershipLevel: 'premium', // 追加: 必要な会員レベル
  isRestricted: true,         // 追加: 制限フラグ
  // 既存フィールド...
}
```

### セミナー（Seminars）
```javascript
{
  id: 1,
  title: 'DXセミナー',
  membershipRequirement: 'basic', // 追加: 必要な会員レベル
  isPublic: false,                // 追加: 公開/限定フラグ
  // 既存フィールド...
}
```

## 🎨 UI/UXデザイン仕様

### ぼかし表示のスタイル
```css
.blurred-preview {
  filter: blur(8px);
  opacity: 0.7;
  user-select: none;
  pointer-events: none;
}

.restriction-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.95);
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  text-align: center;
}
```

### 会員ランクバッジ
```css
.membership-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.badge-basic { background: #e3f2fd; color: #1976d2; }
.badge-standard { background: #f3e5f5; color: #7b1fa2; }
.badge-premium { background: #fff3e0; color: #f57c00; }
```

## 🔄 実装フロー

### Phase 1: 基盤構築（2日）
1. ✅ Vuexストアの実装
   - 認証状態管理
   - 会員情報管理
   - アクセス権限チェック

2. ✅ 認証APIの整備
   - ログイン/ログアウト
   - 会員情報取得
   - トークン管理

### Phase 2: 共通コンポーネント（2日）
1. ✅ ContentRestriction.vue作成
2. ✅ MembershipBadge.vue作成
3. ✅ UpgradePrompt.vue作成
4. ✅ LoginPrompt.vue作成

### Phase 3: 刊行物ページ実装（2日）
1. ✅ PublicationsMemberPage.vueの改修
2. ✅ PublicationDetailPage.vueの改修
3. ✅ ダウンロード制限の実装

### Phase 4: セミナーページ実装（2日）
1. ✅ CurrentSeminarsPage.vueの改修
2. ✅ SeminarDetailPage.vueの改修
3. ✅ 申込み制限の実装

### Phase 5: テスト・調整（2日）
1. ✅ 各会員ランクでの動作確認
2. ✅ 非ログイン状態での表示確認
3. ✅ アップグレードフローの確認

## 🧪 テストシナリオ

### 1. 非ログインユーザー
- [ ] 無料コンテンツは閲覧可能
- [ ] 有料コンテンツはぼかし表示
- [ ] ログイン誘導が表示される

### 2. 無料会員
- [ ] 無料コンテンツのみアクセス可能
- [ ] 有料コンテンツはアップグレード誘導

### 3. ベーシック会員
- [ ] ベーシックレベルまでアクセス可能
- [ ] スタンダード以上は制限表示

### 4. スタンダード会員
- [ ] スタンダードレベルまでアクセス可能
- [ ] プレミアムコンテンツは制限表示

### 5. プレミアム会員
- [ ] 全てのコンテンツにアクセス可能
- [ ] 制限表示なし

## 📝 APIエンドポイント

### 必要なAPI（Laravel側）
```php
// 認証関連
POST   /api/member/login        // ログイン
POST   /api/member/logout       // ログアウト
GET    /api/member/profile      // プロフィール取得
PUT    /api/member/upgrade      // プランアップグレード

// コンテンツアクセス確認
GET    /api/member/can-access/{type}/{id}  // アクセス可否確認
```

## 🚀 デプロイチェックリスト

- [ ] 環境変数の設定
- [ ] APIエンドポイントの疎通確認
- [ ] 会員データのマイグレーション
- [ ] アクセス権限の動作確認
- [ ] ぼかし表示の確認
- [ ] アップグレードフローの確認

## 📊 成功指標

1. **技術的指標**
   - ページロード時間: 3秒以内
   - エラー率: 1%以下
   - API応答時間: 500ms以内

2. **ビジネス指標**
   - 会員登録率の向上: +20%
   - アップグレード率: +15%
   - コンテンツエンゲージメント: +30%

## ⚠️ 注意事項

1. **セキュリティ**
   - フロントエンドでの制限は見せかけのみ
   - 実際の制限はバックエンド（Laravel）で実装
   - トークンの安全な管理

2. **パフォーマンス**
   - 大量のコンテンツでもスムーズな表示
   - 遅延ローディングの活用
   - キャッシュの適切な利用

3. **ユーザビリティ**
   - 制限理由の明確な表示
   - スムーズなアップグレード導線
   - フラストレーションの最小化

## 🔧 技術スタック

- **フロントエンド**: Vue.js 2.x, Vuex, Vue Router
- **バックエンド**: Laravel 8.x
- **認証**: Laravel Sanctum
- **スタイリング**: CSS3, Flexbox, Grid
- **アニメーション**: CSS Transitions, Vue Transitions

## 📅 スケジュール

| フェーズ | 期間 | 状態 |
|---------|-----|------|
| Phase 1: 基盤構築 | 2日 | 🔄 開始前 |
| Phase 2: 共通コンポーネント | 2日 | 🔄 開始前 |
| Phase 3: 刊行物ページ | 2日 | 🔄 開始前 |
| Phase 4: セミナーページ | 2日 | 🔄 開始前 |
| Phase 5: テスト・調整 | 2日 | 🔄 開始前 |
| **合計** | **10日** | - |

---

作成日: 2025年8月31日
更新日: 2025年8月31日
バージョン: 1.0.0